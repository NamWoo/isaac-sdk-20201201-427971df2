var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.getGlobal=function(c){c=["object"==typeof globalThis&&globalThis,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,c];for(var h=0;h<c.length;++h){var l=c[h];if(l&&l.Math==Math)return l}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.checkEs6ConformanceViaProxy=function(){try{var c={},h=Object.create(new $jscomp.global.Proxy(c,{get:function(l,k,p){return l==c&&"q"==k&&p==h}}));return!0===h.q}catch(l){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.arrayIteratorImpl=function(c){var h=0;return function(){return h<c.length?{done:!1,value:c[h++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};
$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,h,l){c!=Array.prototype&&c!=Object.prototype&&(c[h]=l.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(c,h){this.$jscomp$symbol$id_=c;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:h})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function c(l){if(this instanceof c)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(l||"")+"_"+h++,l)}var h=0;return c}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.asyncIterator;c||(c=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};
$jscomp.makeIterator=function(c){var h="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];return h?h.call(c):$jscomp.arrayIterator(c)};$jscomp.owns=function(c,h){return Object.prototype.hasOwnProperty.call(c,h)};$jscomp.polyfill=function(c,h,l,k){if(h){l=$jscomp.global;c=c.split(".");for(k=0;k<c.length-1;k++){var p=c[k];p in l||(l[p]={});l=l[p]}c=c[c.length-1];k=l[c];h=h(k);h!=k&&null!=h&&$jscomp.defineProperty(l,c,{configurable:!0,writable:!0,value:h})}};
$jscomp.polyfill("WeakMap",function(c){function h(){if(!c||!Object.seal)return!1;try{var B=Object.seal({}),g=Object.seal({}),h=new c([[B,2],[g,3]]);if(2!=h.get(B)||3!=h.get(g))return!1;h.delete(B);h.set(g,4);return!h.has(B)&&4==h.get(g)}catch(D){return!1}}function l(){}function k(c){var g=typeof c;return"object"===g&&null!==c||"function"===g}function p(c){if(!$jscomp.owns(c,r)){var g=new l;$jscomp.defineProperty(c,r,{value:g})}}function w(c){var g=Object[c];g&&(Object[c]=function(c){if(c instanceof
l)return c;p(c);return g(c)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(c&&$jscomp.ES6_CONFORMANCE)return c}else if(h())return c;var r="$jscomp_hidden_"+Math.random();w("freeze");w("preventExtensions");w("seal");var A=0,g=function(c){this.id_=(A+=Math.random()+1).toString();if(c){c=$jscomp.makeIterator(c);for(var g;!(g=c.next()).done;)g=g.value,this.set(g[0],g[1])}};g.prototype.set=function(c,g){if(!k(c))throw Error("Invalid WeakMap key");p(c);if(!$jscomp.owns(c,r))throw Error("WeakMap key fail: "+
c);c[r][this.id_]=g;return this};g.prototype.get=function(c){return k(c)&&$jscomp.owns(c,r)?c[r][this.id_]:void 0};g.prototype.has=function(c){return k(c)&&$jscomp.owns(c,r)&&$jscomp.owns(c[r],this.id_)};g.prototype.delete=function(c){return k(c)&&$jscomp.owns(c,r)&&$jscomp.owns(c[r],this.id_)?delete c[r][this.id_]:!1};return g},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(c){function h(){if($jscomp.ASSUME_NO_NATIVE_MAP||!c||"function"!=typeof c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var g=Object.seal({x:4}),h=new c($jscomp.makeIterator([[g,"s"]]));if("s"!=h.get(g)||1!=h.size||h.get({x:4})||h.set({x:4},"t")!=h||2!=h.size)return!1;var z=h.entries(),l=z.next();if(l.done||l.value[0]!=g||"s"!=l.value[1])return!1;l=z.next();return l.done||4!=l.value[0].x||"t"!=l.value[1]||!z.next().done?!1:!0}catch(D){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(c&&$jscomp.ES6_CONFORMANCE)return c}else if(h())return c;$jscomp.initSymbolIterator();var l=new WeakMap,k=function(c){this.data_={};this.head_=r();this.size=0;if(c){c=$jscomp.makeIterator(c);for(var g;!(g=c.next()).done;)g=g.value,this.set(g[0],g[1])}};k.prototype.set=function(c,h){c=0===c?0:c;var g=p(this,c);g.list||(g.list=this.data_[g.id]=[]);g.entry?g.entry.value=h:(g.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:c,
value:h},g.list.push(g.entry),this.head_.previous.next=g.entry,this.head_.previous=g.entry,this.size++);return this};k.prototype.delete=function(c){c=p(this,c);return c.entry&&c.list?(c.list.splice(c.index,1),c.list.length||delete this.data_[c.id],c.entry.previous.next=c.entry.next,c.entry.next.previous=c.entry.previous,c.entry.head=null,this.size--,!0):!1};k.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=r();this.size=0};k.prototype.has=function(c){return!!p(this,c).entry};
k.prototype.get=function(c){return(c=p(this,c).entry)&&c.value};k.prototype.entries=function(){return w(this,function(c){return[c.key,c.value]})};k.prototype.keys=function(){return w(this,function(c){return c.key})};k.prototype.values=function(){return w(this,function(c){return c.value})};k.prototype.forEach=function(c,h){for(var g=this.entries(),l;!(l=g.next()).done;)l=l.value,c.call(h,l[1],l[0],this)};k.prototype[Symbol.iterator]=k.prototype.entries;var p=function(c,h){var g=h&&typeof h;"object"==
g||"function"==g?l.has(h)?g=l.get(h):(g=""+ ++A,l.set(h,g)):g="p_"+h;var k=c.data_[g];if(k&&$jscomp.owns(c.data_,g))for(c=0;c<k.length;c++){var p=k[c];if(h!==h&&p.key!==p.key||h===p.key)return{id:g,list:k,index:c,entry:p}}return{id:g,list:k,index:-1,entry:void 0}},w=function(c,h){var g=c.head_;return $jscomp.iteratorPrototype(function(){if(g){for(;g.head!=c.head_;)g=g.previous;for(;g.next!=g.head;)return g=g.next,{done:!1,value:h(g)};g=null}return{done:!0,value:void 0}})},r=function(){var c={};return c.previous=
c.next=c.head=c},A=0;return k},"es6","es3");$jscomp.checkStringArgs=function(c,h,l){if(null==c)throw new TypeError("The 'this' value for String.prototype."+l+" must not be null or undefined");if(h instanceof RegExp)throw new TypeError("First argument to String.prototype."+l+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.repeat",function(c){return c?c:function(c){var h=$jscomp.checkStringArgs(this,null,"repeat");if(0>c||1342177279<c)throw new RangeError("Invalid count value");c|=0;for(var k="";c;)if(c&1&&(k+=h),c>>>=1)h+=h;return k}},"es6","es3");
$jscomp.iteratorFromArray=function(c,h){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var l=0,k={next:function(){if(l<c.length){var p=l++;return{value:h(p,c[p]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,l){return l})}},"es8","es3");
THREE.FBXLoader=function(){function c(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager}function h(a){this.textureLoader=a}function l(){}function k(){}function p(){}function w(){}function r(a,b){this.dv=new DataView(a);this.offset=0;this.littleEndian=void 0!==b?b:!0}function A(){}function g(a){if(a=a.match(/FBXVersion: (\d+)/))return parseInt(a[1]);throw Error("THREE.FBXLoader: Cannot find the version number for the file given.");}function B(a){return a/46186158E3}function z(a,b,d,f){switch(f.mappingType){case "ByPolygonVertex":var e=
a;break;case "ByPolygon":e=b;break;case "ByVertice":e=d;break;case "AllSame":e=f.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+f.mappingType)}"IndexToDirect"===f.referenceType&&(e=f.indices[e]);d=e*f.dataSize;a=K;b=f.buffer;f=d+f.dataSize;for(e=0;d<f;d++,e++)a[e]=b[d];return a}function H(a){var b=new THREE.Matrix4,d=new THREE.Matrix4,f=new THREE.Matrix4,e=new THREE.Matrix4,c=new THREE.Matrix4,m=new THREE.Matrix4,x=new THREE.Matrix4,y=new THREE.Matrix4,h=
new THREE.Matrix4,g=new THREE.Matrix4,l=new THREE.Matrix4,k=a.inheritType?a.inheritType:0;a.translation&&b.setPosition(C.fromArray(a.translation));if(a.preRotation){var n=a.preRotation.map(THREE.Math.degToRad);n.push(a.eulerOrder);d.makeRotationFromEuler(F.fromArray(n))}a.rotation&&(n=a.rotation.map(THREE.Math.degToRad),n.push(a.eulerOrder),f.makeRotationFromEuler(F.fromArray(n)));a.postRotation&&(n=a.postRotation.map(THREE.Math.degToRad),n.push(a.eulerOrder),e.makeRotationFromEuler(F.fromArray(n)));
a.scale&&c.scale(C.fromArray(a.scale));a.scalingOffset&&x.setPosition(C.fromArray(a.scalingOffset));a.scalingPivot&&m.setPosition(C.fromArray(a.scalingPivot));a.rotationOffset&&y.setPosition(C.fromArray(a.rotationOffset));a.rotationPivot&&h.setPosition(C.fromArray(a.rotationPivot));a.parentMatrixWorld&&(g=a.parentMatrixWorld);a=d.multiply(f).multiply(e);n=new THREE.Matrix4;g.extractRotation(n);var p=new THREE.Matrix4;p.copyPosition(g);p=p.getInverse(p).multiply(g);p=n.getInverse(n).multiply(p);0===
k?k=n.multiply(a).multiply(p).multiply(c):1===k?k=n.multiply(p).multiply(a).multiply(c):(k=(new THREE.Matrix4).copy(c),k=p.multiply(k.getInverse(k)),k=n.multiply(a).multiply(k).multiply(c));b=b.multiply(y).multiply(h).multiply(d).multiply(f).multiply(e).multiply(h.getInverse(h)).multiply(x).multiply(m).multiply(c).multiply(m.getInverse(m));b=(new THREE.Matrix4).copyPosition(b);g=g.multiply(b);l.copyPosition(g);return b=l.multiply(k)}function D(a){a=a||0;var b="ZYX YZX XZY ZXY YXZ XYZ".split(" ");
return 6===a?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),b[0]):b[a]}function G(a){return a.split(",").map(function(a){return parseFloat(a)})}function I(a,b,d){void 0===b&&(b=0);void 0===d&&(d=a.byteLength);return THREE.LoaderUtils.decodeText(new Uint8Array(a,b,d))}function L(a,b){for(var d=0,f=a.length,e=b.length;d<e;d++,f++)a[f]=b[d]}function J(a,b,d){return a.slice(0,b).concat(d).concat(a.slice(b))}var n,q,u;c.prototype={constructor:c,
crossOrigin:"anonymous",load:function(a,b,d,f){var e=this,c=void 0===e.path?THREE.LoaderUtils.extractUrlBase(a):e.path,m=new THREE.FileLoader(this.manager);m.setPath(e.path);m.setResponseType("arraybuffer");m.load(a,function(d){try{b(e.parse(d,c))}catch(y){setTimeout(function(){f&&f(y);e.manager.itemError(a)},0)}},d,f)},setPath:function(a){this.path=a;return this},setResourcePath:function(a){this.resourcePath=a;return this},setCrossOrigin:function(a){this.crossOrigin=a;return this},parse:function(a,
b){if(21<=a.byteLength&&"Kaydara FBX Binary  \x00"===I(a,0,21))n=(new w).parse(a);else{a=I(a);a:{var d=a;for(var f="Kaydara\\FBX\\Binary\\\\".split(""),e=0,c=0;c<f.length;++c){var m=d[0];d=d.slice(e+1);e++;if(m===f[c]){d=!1;break a}}d=!0}if(!d)throw Error("THREE.FBXLoader: Unknown format.");if(7E3>g(a))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+g(a));n=(new p).parse(a)}b=(new THREE.TextureLoader(this.manager)).setPath(this.resourcePath||b).setCrossOrigin(this.crossOrigin);
return(new h(b)).parse(n)}};h.prototype={constructor:h,parse:function(){q=this.parseConnections();var a=this.parseImages();a=this.parseTextures(a);a=this.parseMaterials(a);var b=this.parseDeformers(),d=(new l).parse(b);this.parseScene(b,d,a);return u},parseConnections:function(){var a=new Map;"Connections"in n&&n.Connections.connections.forEach(function(b){var d=b[0],f=b[1];b=b[2];a.has(d)||a.set(d,{parents:[],children:[]});var e={ID:f,relationship:b};a.get(d).parents.push(e);a.has(f)||a.set(f,{parents:[],
children:[]});d={ID:d,relationship:b};a.get(f).children.push(d)});return a},parseImages:function(){var a={},b={};if("Video"in n.Objects){var d=n.Objects.Video,f;for(f in d){var e=d[f],c=parseInt(f);a[c]=e.RelativeFilename||e.Filename;if("Content"in e){var m="string"===typeof e.Content&&""!==e.Content;if(e.Content instanceof ArrayBuffer&&0<e.Content.byteLength||m)m=this.parseImage(d[f]),b[e.RelativeFilename||e.Filename]=m}}}for(c in a)d=a[c],a[c]=void 0!==b[d]?b[d]:a[c].split("\\").pop();return a},
parseImage:function(a){var b=a.Content;a=a.RelativeFilename||a.Filename;var d=a.slice(a.lastIndexOf(".")+1).toLowerCase();switch(d){case "bmp":a="image/bmp";break;case "jpg":case "jpeg":a="image/jpeg";break;case "png":a="image/png";break;case "tif":a="image/tiff";break;case "tga":null===THREE.Loader.Handlers.get(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",a);a="image/tga";break;default:console.warn('FBXLoader: Image type "'+d+'" is not supported.');return}if("string"===typeof b)return"data:"+
a+";base64,"+b;b=new Uint8Array(b);return window.URL.createObjectURL(new Blob([b],{type:a}))},parseTextures:function(a){var b=new Map;if("Texture"in n.Objects){var d=n.Objects.Texture,f;for(f in d){var e=this.parseTexture(d[f],a);b.set(parseInt(f),e)}}return b},parseTexture:function(a,b){b=this.loadTexture(a,b);b.ID=a.id;b.name=a.attrName;var d=a.WrapModeU,f=a.WrapModeV;f=void 0!==f?f.value:0;b.wrapS=0===(void 0!==d?d.value:0)?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;b.wrapT=0===f?THREE.RepeatWrapping:
THREE.ClampToEdgeWrapping;"Scaling"in a&&(a=a.Scaling.value,b.repeat.x=a[0],b.repeat.y=a[1]);return b},loadTexture:function(a,b){var d=this.textureLoader.path,f=q.get(a.id).children;if(void 0!==f&&0<f.length&&void 0!==b[f[0].ID]){var e=b[f[0].ID];0!==e.indexOf("blob:")&&0!==e.indexOf("data:")||this.textureLoader.setPath(void 0)}b=a.FileName.slice(-3).toLowerCase();"tga"===b?(b=THREE.Loader.Handlers.get(".tga"),null===b?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",
a.RelativeFilename),a=new THREE.Texture):a=b.load(e)):"psd"===b?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",a.RelativeFilename),a=new THREE.Texture):a=this.textureLoader.load(e);this.textureLoader.setPath(d);return a},parseMaterials:function(a){var b=new Map;if("Material"in n.Objects){var d=n.Objects.Material,f;for(f in d){var e=this.parseMaterial(d[f],a);null!==e&&b.set(parseInt(f),e)}}return b},parseMaterial:function(a,b){var d=a.id,f=a.attrName,e=
a.ShadingModel;"object"===typeof e&&(e=e.value);if(!q.has(d))return null;a=this.parseParameters(a,b,d);switch(e.toLowerCase()){case "phong":e=new THREE.MeshPhongMaterial;break;case "lambert":e=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',e),e=new THREE.MeshPhongMaterial}e.setValues(a);e.name=f;return e},parseParameters:function(a,b,d){var f={};a.BumpFactor&&(f.bumpScale=a.BumpFactor.value);a.Diffuse?f.color=
(new THREE.Color).fromArray(a.Diffuse.value):a.DiffuseColor&&"Color"===a.DiffuseColor.type&&(f.color=(new THREE.Color).fromArray(a.DiffuseColor.value));a.DisplacementFactor&&(f.displacementScale=a.DisplacementFactor.value);a.Emissive?f.emissive=(new THREE.Color).fromArray(a.Emissive.value):a.EmissiveColor&&"Color"===a.EmissiveColor.type&&(f.emissive=(new THREE.Color).fromArray(a.EmissiveColor.value));a.EmissiveFactor&&(f.emissiveIntensity=parseFloat(a.EmissiveFactor.value));a.Opacity&&(f.opacity=
parseFloat(a.Opacity.value));1>f.opacity&&(f.transparent=!0);a.ReflectionFactor&&(f.reflectivity=a.ReflectionFactor.value);a.Shininess&&(f.shininess=a.Shininess.value);a.Specular?f.specular=(new THREE.Color).fromArray(a.Specular.value):a.SpecularColor&&"Color"===a.SpecularColor.type&&(f.specular=(new THREE.Color).fromArray(a.SpecularColor.value));var e=this;q.get(d).children.forEach(function(a){var d=a.relationship;switch(d){case "Bump":f.bumpMap=e.getTexture(b,a.ID);break;case "Maya|TEX_ao_map":f.aoMap=
e.getTexture(b,a.ID);break;case "DiffuseColor":case "Maya|TEX_color_map":f.map=e.getTexture(b,a.ID);f.map.encoding=THREE.sRGBEncoding;break;case "DisplacementColor":f.displacementMap=e.getTexture(b,a.ID);break;case "EmissiveColor":f.emissiveMap=e.getTexture(b,a.ID);f.emissiveMap.encoding=THREE.sRGBEncoding;break;case "NormalMap":case "Maya|TEX_normal_map":f.normalMap=e.getTexture(b,a.ID);break;case "ReflectionColor":f.envMap=e.getTexture(b,a.ID);f.envMap.mapping=THREE.EquirectangularReflectionMapping;
f.envMap.encoding=THREE.sRGBEncoding;break;case "SpecularColor":f.specularMap=e.getTexture(b,a.ID);f.specularMap.encoding=THREE.sRGBEncoding;break;case "TransparentColor":f.alphaMap=e.getTexture(b,a.ID);f.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",d)}});return f},getTexture:function(a,b){"LayeredTexture"in n.Objects&&b in n.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),
b=q.get(b).children[0].ID);return a.get(b)},parseDeformers:function(){var a={},b={};if("Deformer"in n.Objects){var d=n.Objects.Deformer,f;for(f in d){var e=d[f],c=q.get(parseInt(f));"Skin"===e.attrType?(e=this.parseSkeleton(c,d),e.ID=f,1<c.parents.length&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),e.geometryID=c.parents[0].ID,a[f]=e):"BlendShape"===e.attrType&&(e={id:f},e.rawTargets=this.parseMorphTargets(c,d),e.id=f,1<c.parents.length&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),
b[f]=e)}}return{skeletons:a,morphTargets:b}},parseSkeleton:function(a,b){var d=[];a.children.forEach(function(a){var f=b[a.ID];"Cluster"===f.attrType&&(a={ID:a.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(f.TransformLink.a)},"Indexes"in f&&(a.indices=f.Indexes.a,a.weights=f.Weights.a),d.push(a))});return{rawBones:d,bones:[]}},parseMorphTargets:function(a,b){for(var d=[],f=0;f<a.children.length;f++){var e=a.children[f],c=b[e.ID],m={name:c.attrName,initialWeight:c.DeformPercent,
id:c.id,fullWeights:c.FullWeights.a};if("BlendShapeChannel"!==c.attrType)return;m.geoID=q.get(parseInt(e.ID)).children.filter(function(a){return void 0===a.relationship})[0].ID;d.push(m)}return d},parseScene:function(a,b,d){u=new THREE.Group;var f=this.parseModels(a.skeletons,b,d),e=n.Objects.Model,c=this;f.forEach(function(a){c.setLookAtProperties(a,e[a.ID]);q.get(a.ID).parents.forEach(function(b){b=f.get(b.ID);void 0!==b&&b.add(a)});null===a.parent&&u.add(a)});this.bindSkeleton(a.skeletons,b,f);
this.createAmbientLight();this.setupMorphMaterials();u.traverse(function(a){if(a.userData.transformData){a.parent&&(a.userData.transformData.parentMatrixWorld=a.parent.matrix);var b=H(a.userData.transformData);a.applyMatrix(b)}});a=(new k).parse();1===u.children.length&&u.children[0].isGroup&&(u.children[0].animations=a,u=u.children[0]);u.animations=a},parseModels:function(a,b,d){var f=new Map,e=n.Objects.Model,c;for(c in e){var m=parseInt(c),x=e[c],g=q.get(m),h=this.buildSkeleton(g,a,m,x.attrName);
if(!h){switch(x.attrType){case "Camera":h=this.createCamera(g);break;case "Light":h=this.createLight(g);break;case "Mesh":h=this.createMesh(g,b,d);break;case "NurbsCurve":h=this.createCurve(g,b);break;case "LimbNode":case "Root":h=new THREE.Bone;break;default:h=new THREE.Group}h.name=THREE.PropertyBinding.sanitizeNodeName(x.attrName);h.ID=m}this.getTransformData(h,x);f.set(m,h)}return f},buildSkeleton:function(a,b,d,f){var e=null;a.parents.forEach(function(a){for(var c in b){var t=b[c];t.rawBones.forEach(function(b,
c){if(b.ID===a.ID){var m=e;e=new THREE.Bone;e.matrixWorld.copy(b.transformLink);e.name=THREE.PropertyBinding.sanitizeNodeName(f);e.ID=d;t.bones[c]=e;null!==m&&e.add(m)}})}});return e},createCamera:function(a){var b;a.children.forEach(function(a){a=n.Objects.NodeAttribute[a.ID];void 0!==a&&(b=a)});if(void 0===b)var d=new THREE.Object3D;else{d=0;void 0!==b.CameraProjectionType&&1===b.CameraProjectionType.value&&(d=1);var f=1;void 0!==b.NearPlane&&(f=b.NearPlane.value/1E3);var e=1E3;void 0!==b.FarPlane&&
(e=b.FarPlane.value/1E3);var c=window.innerWidth,m=window.innerHeight;void 0!==b.AspectWidth&&void 0!==b.AspectHeight&&(c=b.AspectWidth.value,m=b.AspectHeight.value);var h=c/m,g=45;void 0!==b.FieldOfView&&(g=b.FieldOfView.value);a=b.FocalLength?b.FocalLength.value:null;switch(d){case 0:d=new THREE.PerspectiveCamera(g,h,f,e);null!==a&&d.setFocalLength(a);break;case 1:d=new THREE.OrthographicCamera(-c/2,c/2,m/2,-m/2,f,e);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+d+"."),d=new THREE.Object3D}}return d},
createLight:function(a){var b;a.children.forEach(function(a){a=n.Objects.NodeAttribute[a.ID];void 0!==a&&(b=a)});if(void 0===b)a=new THREE.Object3D;else{var d=void 0===b.LightType?0:b.LightType.value;a=16777215;void 0!==b.Color&&(a=(new THREE.Color).fromArray(b.Color.value));var f=void 0===b.Intensity?1:b.Intensity.value/100;void 0!==b.CastLightOnObject&&0===b.CastLightOnObject.value&&(f=0);var e=0;void 0!==b.FarAttenuationEnd&&(e=void 0!==b.EnableFarAttenuation&&0===b.EnableFarAttenuation.value?
0:b.FarAttenuationEnd.value);switch(d){case 0:a=new THREE.PointLight(a,f,e,1);break;case 1:a=new THREE.DirectionalLight(a,f);break;case 2:d=Math.PI/3;void 0!==b.InnerAngle&&(d=THREE.Math.degToRad(b.InnerAngle.value));var c=0;void 0!==b.OuterAngle&&(c=THREE.Math.degToRad(b.OuterAngle.value),c=Math.max(c,1));a=new THREE.SpotLight(a,f,e,d,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+b.LightType.value+", defaulting to a THREE.PointLight."),a=new THREE.PointLight(a,f)}void 0!==
b.CastShadows&&1===b.CastShadows.value&&(a.castShadow=!0)}return a},createMesh:function(a,b,d){var f=null,e=null,c=[];a.children.forEach(function(a){b.has(a.ID)&&(f=b.get(a.ID));d.has(a.ID)&&c.push(d.get(a.ID))});1<c.length?e=c:0<c.length?e=c[0]:(e=new THREE.MeshPhongMaterial({color:13421772}),c.push(e));"color"in f.attributes&&c.forEach(function(a){a.vertexColors=THREE.VertexColors});f.FBX_Deformer?(c.forEach(function(a){a.skinning=!0}),a=new THREE.SkinnedMesh(f,e),a.normalizeSkinWeights()):a=new THREE.Mesh(f,
e);return a},createCurve:function(a,b){a=a.children.reduce(function(a,d){b.has(d.ID)&&(a=b.get(d.ID));return a},null);var d=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(a,d)},getTransformData:function(a,b){var d={};"InheritType"in b&&(d.inheritType=parseInt(b.InheritType.value));d.eulerOrder="RotationOrder"in b?D(b.RotationOrder.value):"ZYX";"Lcl_Translation"in b&&(d.translation=b.Lcl_Translation.value);"PreRotation"in b&&(d.preRotation=b.PreRotation.value);"Lcl_Rotation"in
b&&(d.rotation=b.Lcl_Rotation.value);"PostRotation"in b&&(d.postRotation=b.PostRotation.value);"Lcl_Scaling"in b&&(d.scale=b.Lcl_Scaling.value);"ScalingOffset"in b&&(d.scalingOffset=b.ScalingOffset.value);"ScalingPivot"in b&&(d.scalingPivot=b.ScalingPivot.value);"RotationOffset"in b&&(d.rotationOffset=b.RotationOffset.value);"RotationPivot"in b&&(d.rotationPivot=b.RotationPivot.value);a.userData.transformData=d},setLookAtProperties:function(a,b){"LookAtProperty"in b&&q.get(a.ID).children.forEach(function(b){"LookAtProperty"===
b.relationship&&(b=n.Objects.Model[b.ID],"Lcl_Translation"in b&&(b=b.Lcl_Translation.value,void 0!==a.target?(a.target.position.fromArray(b),u.add(a.target)):a.lookAt((new THREE.Vector3).fromArray(b))))})},bindSkeleton:function(a,b,d){var f=this.parsePoseNodes(),e;for(e in a){var c=a[e];q.get(parseInt(c.ID)).parents.forEach(function(a){b.has(a.ID)&&q.get(a.ID).parents.forEach(function(a){d.has(a.ID)&&d.get(a.ID).bind(new THREE.Skeleton(c.bones),f[a.ID])})})}},parsePoseNodes:function(){var a={};if("Pose"in
n.Objects){var b=n.Objects.Pose,d;for(d in b)if("BindPose"===b[d].attrType){var f=b[d].PoseNode;Array.isArray(f)?f.forEach(function(b){a[b.Node]=(new THREE.Matrix4).fromArray(b.Matrix.a)}):a[f.Node]=(new THREE.Matrix4).fromArray(f.Matrix.a)}}return a},createAmbientLight:function(){if("GlobalSettings"in n&&"AmbientColor"in n.GlobalSettings){var a=n.GlobalSettings.AmbientColor.value,b=a[0],d=a[1];a=a[2];if(0!==b||0!==d||0!==a)b=new THREE.Color(b,d,a),u.add(new THREE.AmbientLight(b,1))}},setupMorphMaterials:function(){var a=
this;u.traverse(function(b){b.isMesh&&b.geometry.morphAttributes.position&&b.geometry.morphAttributes.position.length&&(Array.isArray(b.material)?b.material.forEach(function(d,f){a.setupMorphMaterial(b,d,f)}):a.setupMorphMaterial(b,b.material))})},setupMorphMaterial:function(a,b,d){var f=a.uuid,e=b.uuid,c=!1;u.traverse(function(a){a.isMesh&&(Array.isArray(a.material)?a.material.forEach(function(b){b.uuid===e&&a.uuid!==f&&(c=!0)}):a.material.uuid===e&&a.uuid!==f&&(c=!0))});!0===c?(b=b.clone(),b.morphTargets=
!0,void 0===d?a.material=b:a.material[d]=b):b.morphTargets=!0}};l.prototype={constructor:l,parse:function(a){var b=new Map;if("Geometry"in n.Objects){var d=n.Objects.Geometry,f;for(f in d){var e=q.get(parseInt(f));e=this.parseGeometry(e,d[f],a);b.set(parseInt(f),e)}}return b},parseGeometry:function(a,b,d){switch(b.attrType){case "Mesh":return this.parseMeshGeometry(a,b,d);case "NurbsCurve":return this.parseNurbsGeometry(b)}},parseMeshGeometry:function(a,b,d){var f=d.skeletons,e=d.morphTargets,c=a.parents.map(function(a){return n.Objects.Model[a.ID]});
if(0!==c.length){d=a.children.reduce(function(a,b){void 0!==f[b.ID]&&(a=f[b.ID]);return a},null);a=a.children.reduce(function(a,b){void 0!==e[b.ID]&&(a=e[b.ID]);return a},null);c=c[0];var m={};"RotationOrder"in c&&(m.eulerOrder=D(c.RotationOrder.value));"InheritType"in c&&(m.inheritType=parseInt(c.InheritType.value));"GeometricTranslation"in c&&(m.translation=c.GeometricTranslation.value);"GeometricRotation"in c&&(m.rotation=c.GeometricRotation.value);"GeometricScaling"in c&&(m.scale=c.GeometricScaling.value);
c=H(m);return this.genGeometry(b,d,a,c)}},genGeometry:function(a,b,d,f){var c=new THREE.BufferGeometry;a.attrName&&(c.name=a.attrName);var t=this.parseGeoNode(a,b),m=this.genBuffers(t),h=new THREE.Float32BufferAttribute(m.vertex,3);f.applyToBufferAttribute(h);c.addAttribute("position",h);0<m.colors.length&&c.addAttribute("color",new THREE.Float32BufferAttribute(m.colors,3));b&&(c.addAttribute("skinIndex",new THREE.Uint16BufferAttribute(m.weightsIndices,4)),c.addAttribute("skinWeight",new THREE.Float32BufferAttribute(m.vertexWeights,
4)),c.FBX_Deformer=b);0<m.normal.length&&(b=new THREE.Float32BufferAttribute(m.normal,3),(new THREE.Matrix3).getNormalMatrix(f).applyToBufferAttribute(b),c.addAttribute("normal",b));m.uvs.forEach(function(a,b){a="uv"+(b+1).toString();0===b&&(a="uv");c.addAttribute(a,new THREE.Float32BufferAttribute(m.uvs[b],2))});if(t.material&&"AllSame"!==t.material.mappingType){var g=m.materialIndex[0],k=0;m.materialIndex.forEach(function(a,b){a!==g&&(c.addGroup(k,b-k,g),g=a,k=b)});0<c.groups.length&&(t=c.groups[c.groups.length-
1],t=t.start+t.count,t!==m.materialIndex.length&&c.addGroup(t,m.materialIndex.length-t,g));0===c.groups.length&&c.addGroup(0,m.materialIndex.length,m.materialIndex[0])}this.addMorphTargets(c,a,d,f);return c},parseGeoNode:function(a,b){var d={};d.vertexPositions=void 0!==a.Vertices?a.Vertices.a:[];d.vertexIndices=void 0!==a.PolygonVertexIndex?a.PolygonVertexIndex.a:[];a.LayerElementColor&&(d.color=this.parseVertexColors(a.LayerElementColor[0]));a.LayerElementMaterial&&(d.material=this.parseMaterialIndices(a.LayerElementMaterial[0]));
a.LayerElementNormal&&(d.normal=this.parseNormals(a.LayerElementNormal[0]));if(a.LayerElementUV){d.uv=[];for(var f=0;a.LayerElementUV[f];)d.uv.push(this.parseUVs(a.LayerElementUV[f])),f++}d.weightTable={};null!==b&&(d.skeleton=b,b.rawBones.forEach(function(a,b){a.indices.forEach(function(f,c){void 0===d.weightTable[f]&&(d.weightTable[f]=[]);d.weightTable[f].push({id:b,weight:a.weights[c]})})}));return d},genBuffers:function(a){var b={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],
weightsIndices:[]},d=0,f=0,c=!1,h=[],m=[],g=[],k=[],l=[],E=[],n=this;a.vertexIndices.forEach(function(e,t){var x=!1;0>e&&(e^=-1,x=!0);var y=[],p=[];h.push(3*e,3*e+1,3*e+2);if(a.color){var v=z(t,d,e,a.color);g.push(v[0],v[1],v[2])}if(a.skeleton){void 0!==a.weightTable[e]&&a.weightTable[e].forEach(function(a){p.push(a.weight);y.push(a.id)});if(4<p.length){c||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),c=!0);var q=[0,0,0,
0],r=[0,0,0,0];p.forEach(function(a,b){var d=a,f=y[b];r.forEach(function(a,b,c){d>a&&(c[b]=d,d=a,a=q[b],q[b]=f,f=a)})});y=q;p=r}for(;4>p.length;)p.push(0),y.push(0);for(v=0;4>v;++v)l.push(p[v]),E.push(y[v])}a.normal&&(v=z(t,d,e,a.normal),m.push(v[0],v[1],v[2]));if(a.material&&"AllSame"!==a.material.mappingType)var u=z(t,d,e,a.material)[0];a.uv&&a.uv.forEach(function(a,b){a=z(t,d,e,a);void 0===k[b]&&(k[b]=[]);k[b].push(a[0]);k[b].push(a[1])});f++;x&&(n.genFace(b,a,h,u,m,g,k,l,E,f),d++,f=0,h=[],m=[],
g=[],k=[],l=[],E=[])});return b},genFace:function(a,b,d,f,c,h,m,g,k,l){for(var e=2;e<l;e++)a.vertex.push(b.vertexPositions[d[0]]),a.vertex.push(b.vertexPositions[d[1]]),a.vertex.push(b.vertexPositions[d[2]]),a.vertex.push(b.vertexPositions[d[3*(e-1)]]),a.vertex.push(b.vertexPositions[d[3*(e-1)+1]]),a.vertex.push(b.vertexPositions[d[3*(e-1)+2]]),a.vertex.push(b.vertexPositions[d[3*e]]),a.vertex.push(b.vertexPositions[d[3*e+1]]),a.vertex.push(b.vertexPositions[d[3*e+2]]),b.skeleton&&(a.vertexWeights.push(g[0]),
a.vertexWeights.push(g[1]),a.vertexWeights.push(g[2]),a.vertexWeights.push(g[3]),a.vertexWeights.push(g[4*(e-1)]),a.vertexWeights.push(g[4*(e-1)+1]),a.vertexWeights.push(g[4*(e-1)+2]),a.vertexWeights.push(g[4*(e-1)+3]),a.vertexWeights.push(g[4*e]),a.vertexWeights.push(g[4*e+1]),a.vertexWeights.push(g[4*e+2]),a.vertexWeights.push(g[4*e+3]),a.weightsIndices.push(k[0]),a.weightsIndices.push(k[1]),a.weightsIndices.push(k[2]),a.weightsIndices.push(k[3]),a.weightsIndices.push(k[4*(e-1)]),a.weightsIndices.push(k[4*
(e-1)+1]),a.weightsIndices.push(k[4*(e-1)+2]),a.weightsIndices.push(k[4*(e-1)+3]),a.weightsIndices.push(k[4*e]),a.weightsIndices.push(k[4*e+1]),a.weightsIndices.push(k[4*e+2]),a.weightsIndices.push(k[4*e+3])),b.color&&(a.colors.push(h[0]),a.colors.push(h[1]),a.colors.push(h[2]),a.colors.push(h[3*(e-1)]),a.colors.push(h[3*(e-1)+1]),a.colors.push(h[3*(e-1)+2]),a.colors.push(h[3*e]),a.colors.push(h[3*e+1]),a.colors.push(h[3*e+2])),b.material&&"AllSame"!==b.material.mappingType&&(a.materialIndex.push(f),
a.materialIndex.push(f),a.materialIndex.push(f)),b.normal&&(a.normal.push(c[0]),a.normal.push(c[1]),a.normal.push(c[2]),a.normal.push(c[3*(e-1)]),a.normal.push(c[3*(e-1)+1]),a.normal.push(c[3*(e-1)+2]),a.normal.push(c[3*e]),a.normal.push(c[3*e+1]),a.normal.push(c[3*e+2])),b.uv&&b.uv.forEach(function(b,d){void 0===a.uvs[d]&&(a.uvs[d]=[]);a.uvs[d].push(m[d][0]);a.uvs[d].push(m[d][1]);a.uvs[d].push(m[d][2*(e-1)]);a.uvs[d].push(m[d][2*(e-1)+1]);a.uvs[d].push(m[d][2*e]);a.uvs[d].push(m[d][2*e+1])})},addMorphTargets:function(a,
b,d,f){if(null!==d){a.morphAttributes.position=[];var c=this;d.rawTargets.forEach(function(d){var e=n.Objects.Geometry[d.geoID];void 0!==e&&c.genMorphGeometry(a,b,e,f,d.name)})}},genMorphGeometry:function(a,b,d,f,c){var e=new THREE.BufferGeometry;d.attrName&&(e.name=d.attrName);e=void 0!==b.PolygonVertexIndex?b.PolygonVertexIndex.a:[];b=void 0!==b.Vertices?b.Vertices.a.slice():[];for(var g=void 0!==d.Vertices?d.Vertices.a:[],h=void 0!==d.Indexes?d.Indexes.a:[],k=0;k<h.length;k++){var l=3*h[k];b[l]+=
g[3*k];b[l+1]+=g[3*k+1];b[l+2]+=g[3*k+2]}e=this.genBuffers({vertexIndices:e,vertexPositions:b});e=new THREE.Float32BufferAttribute(e.vertex,3);e.name=c||d.attrName;f.applyToBufferAttribute(e);a.morphAttributes.position.push(e)},parseNormals:function(a){var b=a.MappingInformationType,d=a.ReferenceInformationType,f=a.Normals.a,c=[];"IndexToDirect"===d&&("NormalIndex"in a?c=a.NormalIndex.a:"NormalsIndex"in a&&(c=a.NormalsIndex.a));return{dataSize:3,buffer:f,indices:c,mappingType:b,referenceType:d}},
parseUVs:function(a){var b=a.MappingInformationType,d=a.ReferenceInformationType,f=a.UV.a,c=[];"IndexToDirect"===d&&(c=a.UVIndex.a);return{dataSize:2,buffer:f,indices:c,mappingType:b,referenceType:d}},parseVertexColors:function(a){var b=a.MappingInformationType,d=a.ReferenceInformationType,f=a.Colors.a,c=[];"IndexToDirect"===d&&(c=a.ColorIndex.a);return{dataSize:4,buffer:f,indices:c,mappingType:b,referenceType:d}},parseMaterialIndices:function(a){var b=a.MappingInformationType,d=a.ReferenceInformationType;
if("NoMappingInformation"===b)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:d};a=a.Materials.a;for(var f=[],c=0;c<a.length;++c)f.push(c);return{dataSize:1,buffer:a,indices:f,mappingType:b,referenceType:d}},parseNurbsGeometry:function(a){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var b=parseInt(a.Order);if(isNaN(b))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",
a.Order,a.id),new THREE.BufferGeometry;--b;for(var d=a.KnotVector.a,f=[],c=a.Points.a,g=0,h=c.length;g<h;g+=4)f.push((new THREE.Vector4).fromArray(c,g));if("Closed"===a.Form)f.push(f[0]);else if("Periodic"===a.Form){var k=b;var l=d.length-1-k;for(g=0;g<b;++g)f.push(f[g])}a=(new THREE.NURBSCurve(b,d,f,k,l)).getPoints(7*f.length);var n=new Float32Array(3*a.length);a.forEach(function(a,b){a.toArray(n,3*b)});a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(n,3));return a}};
k.prototype={constructor:k,parse:function(){var a=[],b=this.parseClips();if(void 0!==b)for(var d in b){var c=this.addClip(b[d]);a.push(c)}return a},parseClips:function(){if(void 0!==n.Objects.AnimationCurve){var a=this.parseAnimationCurveNodes();this.parseAnimationCurves(a);a=this.parseAnimationLayers(a);return this.parseAnimStacks(a)}},parseAnimationCurveNodes:function(){var a=n.Objects.AnimationCurveNode,b=new Map,d;for(d in a){var c=a[d];null!==c.attrName.match(/S|R|T|DeformPercent/)&&(c={id:c.id,
attr:c.attrName,curves:{}},b.set(c.id,c))}return b},parseAnimationCurves:function(a){var b=n.Objects.AnimationCurve,d;for(d in b){var c={id:b[d].id,times:b[d].KeyTime.a.map(B),values:b[d].KeyValueFloat.a},e=q.get(c.id);if(void 0!==e){var g=e.parents[0].ID;e=e.parents[0].relationship;e.match(/X/)?a.get(g).curves.x=c:e.match(/Y/)?a.get(g).curves.y=c:e.match(/Z/)?a.get(g).curves.z=c:e.match(/d|DeformPercent/)&&a.has(g)&&(a.get(g).curves.morph=c)}}},parseAnimationLayers:function(a){var b=n.Objects.AnimationLayer,
d=new Map,c;for(c in b){var e=[];b=q.get(parseInt(c));void 0!==b&&(b.children.forEach(function(b,d){if(a.has(b.ID)){var c=a.get(b.ID);if(void 0!==c.curves.x||void 0!==c.curves.y||void 0!==c.curves.z){if(void 0===e[d]){var f=q.get(b.ID).parents.filter(function(a){return void 0!==a.relationship})[0].ID;if(void 0!==f){var g=n.Objects.Model[f.toString()],h={modelName:THREE.PropertyBinding.sanitizeNodeName(g.attrName),ID:g.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};u.traverse(function(a){a.ID===
g.id&&(h.transform=a.matrix,a.userData.transformData&&(h.eulerOrder=a.userData.transformData.eulerOrder))});h.transform||(h.transform=new THREE.Matrix4);"PreRotation"in g&&(h.preRotation=g.PreRotation.value);"PostRotation"in g&&(h.postRotation=g.PostRotation.value);e[d]=h}}e[d]&&(e[d][c.attr]=c)}else void 0!==c.curves.morph&&(void 0===e[d]&&(b=q.get(b.ID).parents.filter(function(a){return void 0!==a.relationship})[0].ID,f=q.get(b).parents[0].ID,f=q.get(f).parents[0].ID,f=q.get(f).parents[0].ID,g=
n.Objects.Model[f],h={modelName:THREE.PropertyBinding.sanitizeNodeName(g.attrName),morphName:n.Objects.Deformer[b].attrName},e[d]=h),e[d][c.attr]=c)}}),d.set(parseInt(c),e))}return d},parseAnimStacks:function(a){var b=n.Objects.AnimationStack,d={},c;for(c in b){var e=q.get(parseInt(c)).children;1<e.length&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");e=a.get(e[0].ID);d[c]={name:b[c].attrName,layer:e}}return d},
addClip:function(a){var b=[],d=this;a.layer.forEach(function(a){b=b.concat(d.generateTracks(a))});return new THREE.AnimationClip(a.name,-1,b)},generateTracks:function(a){var b=[],d=new THREE.Vector3,c=new THREE.Quaternion,e=new THREE.Vector3;a.transform&&a.transform.decompose(d,c,e);d=d.toArray();c=(new THREE.Euler).setFromQuaternion(c,a.eulerOrder).toArray();e=e.toArray();void 0!==a.T&&0<Object.keys(a.T.curves).length&&(d=this.generateVectorTrack(a.modelName,a.T.curves,d,"position"),void 0!==d&&
b.push(d));void 0!==a.R&&0<Object.keys(a.R.curves).length&&(c=this.generateRotationTrack(a.modelName,a.R.curves,c,a.preRotation,a.postRotation,a.eulerOrder),void 0!==c&&b.push(c));void 0!==a.S&&0<Object.keys(a.S.curves).length&&(e=this.generateVectorTrack(a.modelName,a.S.curves,e,"scale"),void 0!==e&&b.push(e));void 0!==a.DeformPercent&&(a=this.generateMorphTrack(a),void 0!==a&&b.push(a));return b},generateVectorTrack:function(a,b,d,c){var f=this.getTimesForAllAxes(b);b=this.getKeyframeTrackValues(f,
b,d);return new THREE.VectorKeyframeTrack(a+"."+c,f,b)},generateRotationTrack:function(a,b,d,c,e,g){void 0!==b.x&&(this.interpolateRotations(b.x),b.x.values=b.x.values.map(THREE.Math.degToRad));void 0!==b.y&&(this.interpolateRotations(b.y),b.y.values=b.y.values.map(THREE.Math.degToRad));void 0!==b.z&&(this.interpolateRotations(b.z),b.z.values=b.z.values.map(THREE.Math.degToRad));var f=this.getTimesForAllAxes(b);b=this.getKeyframeTrackValues(f,b,d);void 0!==c&&(c=c.map(THREE.Math.degToRad),c.push(g),
c=(new THREE.Euler).fromArray(c),c=(new THREE.Quaternion).setFromEuler(c));void 0!==e&&(e=e.map(THREE.Math.degToRad),e.push(g),e=(new THREE.Euler).fromArray(e),e=(new THREE.Quaternion).setFromEuler(e).inverse());d=new THREE.Quaternion;for(var h=new THREE.Euler,k=[],l=0;l<b.length;l+=3)h.set(b[l],b[l+1],b[l+2],g),d.setFromEuler(h),void 0!==c&&d.premultiply(c),void 0!==e&&d.multiply(e),d.toArray(k,l/3*4);return new THREE.QuaternionKeyframeTrack(a+".quaternion",f,k)},generateMorphTrack:function(a){var b=
a.DeformPercent.curves.morph,d=b.values.map(function(a){return a/100}),c=u.getObjectByName(a.modelName).morphTargetDictionary[a.morphName];return new THREE.NumberKeyframeTrack(a.modelName+".morphTargetInfluences["+c+"]",b.times,d)},getTimesForAllAxes:function(a){var b=[];void 0!==a.x&&(b=b.concat(a.x.times));void 0!==a.y&&(b=b.concat(a.y.times));void 0!==a.z&&(b=b.concat(a.z.times));return b=b.sort(function(a,b){return a-b}).filter(function(a,b,c){return c.indexOf(a)==b})},getKeyframeTrackValues:function(a,
b,d){var c=[],e=-1,g=-1,h=-1;a.forEach(function(a){b.x&&(e=b.x.times.indexOf(a));b.y&&(g=b.y.times.indexOf(a));b.z&&(h=b.z.times.indexOf(a));-1!==e?(a=b.x.values[e],c.push(a),d[0]=a):c.push(d[0]);-1!==g?(a=b.y.values[g],c.push(a),d[1]=a):c.push(d[1]);-1!==h?(a=b.z.values[h],c.push(a),d[2]=a):c.push(d[2])});return c},interpolateRotations:function(a){for(var b=1;b<a.values.length;b++){var d=a.values[b-1],c=a.values[b]-d,e=Math.abs(c);if(180<=e){e/=180;c/=e;d+=c;var g=a.times[b-1];e=(a.times[b]-g)/e;
g+=e;for(var h=[],k=[];g<a.times[b];)h.push(g),g+=e,k.push(d),d+=c;a.times=J(a.times,b,h);a.values=J(a.values,b,k)}}}};p.prototype={constructor:p,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(a){this.nodeStack.push(a);this.currentIndent+=1},popStack:function(){this.nodeStack.pop();--this.currentIndent},setCurrentProp:function(a,b){this.currentProp=
a;this.currentPropName=b},parse:function(a){this.currentIndent=0;this.allNodes=new A;this.nodeStack=[];this.currentProp=[];this.currentPropName="";var b=this,d=a.split(/[\r\n]+/);d.forEach(function(a,c){var e=a.match(/^[\s\t]*;/),f=a.match(/^[\s\t]*$/);if(!e&&!f){e=a.match("^\\t{"+b.currentIndent+"}(\\w+):(.*){","");f=a.match("^\\t{"+b.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)");var g=a.match("^\\t{"+(b.currentIndent-1)+"}}");e?b.parseNodeBegin(a,e):f?b.parseNodeProperty(a,f,d[++c]):g?b.popStack():
a.match(/^[^\s\t}]/)&&b.parseNodePropertyContinued(a)}});return this.allNodes},parseNodeBegin:function(a,b){a=b[1].trim().replace(/^"/,"").replace(/"$/,"");var d=b[2].split(",").map(function(a){return a.trim().replace(/^"/,"").replace(/"$/,"")});b={name:a};d=this.parseNodeAttr(d);var c=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(a,b):a in c?("PoseNode"===a?c.PoseNode.push(b):void 0!==c[a].id&&(c[a]={},c[a][c[a].id]=c[a]),""!==d.id&&(c[a][d.id]=b)):"number"===typeof d.id?(c[a]={},
c[a][d.id]=b):"Properties70"!==a&&(c[a]="PoseNode"===a?[b]:b);"number"===typeof d.id&&(b.id=d.id);""!==d.name&&(b.attrName=d.name);""!==d.type&&(b.attrType=d.type);this.pushStack(b)},parseNodeAttr:function(a){var b=a[0];""!==a[0]&&(b=parseInt(a[0]),isNaN(b)&&(b=a[0]));var c="",f="";1<a.length&&(c=a[1].replace(/^(\w+)::/,""),f=a[2]);return{id:b,name:c,type:f}},parseNodeProperty:function(a,b,c){var d=b[1].replace(/^"/,"").replace(/"$/,"").trim();b=b[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===
d&&","===b&&(b=c.replace(/"/g,"").replace(/,$/,"").trim());c=this.getCurrentNode();if("Properties70"===c.name)this.parseNodeSpecialProperty(a,d,b);else{if("C"===d){d=b.split(",").slice(1);a=parseInt(d[0]);var e=parseInt(d[1]),g=b.split(",").slice(3);g=g.map(function(a){return a.trim().replace(/^"/,"")});d="connections";b=[a,e];L(b,g);void 0===c[d]&&(c[d]=[])}"Node"===d&&(c.id=b);d in c&&Array.isArray(c[d])?c[d].push(b):"a"!==d?c[d]=b:c.a=b;this.setCurrentProp(c,d);"a"===d&&","!==b.slice(-1)&&(c.a=
G(b))}},parseNodePropertyContinued:function(a){var b=this.getCurrentNode();b.a+=a;","!==a.slice(-1)&&(b.a=G(b.a))},parseNodeSpecialProperty:function(a,b,c){var d=c.split('",').map(function(a){return a.trim().replace(/^"/,"").replace(/\s/,"_")});a=d[0];b=d[1];c=d[2];var e=d[3];d=d[4];switch(b){case "int":case "enum":case "bool":case "ULongLong":case "double":case "Number":case "FieldOfView":d=parseFloat(d);break;case "Color":case "ColorRGB":case "Vector3D":case "Lcl_Translation":case "Lcl_Rotation":case "Lcl_Scaling":d=
G(d)}this.getPrevNode()[a]={type:b,type2:c,flag:e,value:d};this.setCurrentProp(this.getPrevNode(),a)}};w.prototype={constructor:w,parse:function(a){a=new r(a);a.skip(23);var b=a.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+b);for(var c=new A;!this.endOfContent(a);){var f=this.parseNode(a,b);null!==f&&c.add(f.name,f)}return c},endOfContent:function(a){return 0===a.size()%16?(a.getOffset()+160+16&-16)>=a.size():a.getOffset()+160+16>=a.size()},parseNode:function(a,b){var c={},f=7500<=
b?a.getUint64():a.getUint32(),e=7500<=b?a.getUint64():a.getUint32();7500<=b?a.getUint64():a.getUint32();var g=a.getUint8();g=a.getString(g);if(0===f)return null;for(var h=[],k=0;k<e;k++)h.push(this.parseProperty(a));k=0<h.length?h[0]:"";var l=1<h.length?h[1]:"",n=2<h.length?h[2]:"";for(c.singleProperty=1===e&&a.getOffset()===f?!0:!1;f>a.getOffset();)e=this.parseNode(a,b),null!==e&&this.parseSubNode(g,c,e);c.propertyList=h;"number"===typeof k&&(c.id=k);""!==l&&(c.attrName=l);""!==n&&(c.attrType=n);
""!==g&&(c.name=g);return c},parseSubNode:function(a,b,c){if(!0===c.singleProperty)a=c.propertyList[0],Array.isArray(a)?(b[c.name]=c,c.a=a):b[c.name]=a;else if("Connections"===a&&"C"===c.name){var d=[];c.propertyList.forEach(function(a,b){0!==b&&d.push(a)});void 0===b.connections&&(b.connections=[]);b.connections.push(d)}else if("Properties70"===c.name)Object.keys(c).forEach(function(a){b[a]=c[a]});else if("Properties70"===a&&"P"===c.name){a=c.propertyList[0];var e=c.propertyList[1],g=c.propertyList[2],
h=c.propertyList[3];0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_"));0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_"));var k="Color"===e||"ColorRGB"===e||"Vector"===e||"Vector3D"===e||0===e.indexOf("Lcl_")?[c.propertyList[4],c.propertyList[5],c.propertyList[6]]:c.propertyList[4];b[a]={type:e,type2:g,flag:h,value:k}}else void 0===b[c.name]?"number"===typeof c.id?(b[c.name]={},b[c.name][c.id]=c):b[c.name]=c:"PoseNode"===c.name?(Array.isArray(b[c.name])||(b[c.name]=[b[c.name]]),b[c.name].push(c)):
void 0===b[c.name][c.id]&&(b[c.name][c.id]=c)},parseProperty:function(a){var b=a.getString(1);switch(b){case "C":return a.getBoolean();case "D":return a.getFloat64();case "F":return a.getFloat32();case "I":return a.getInt32();case "L":return a.getInt64();case "R":return b=a.getUint32(),a.getArrayBuffer(b);case "S":return b=a.getUint32(),a.getString(b);case "Y":return a.getInt16();case "b":case "c":case "d":case "f":case "i":case "l":var c=a.getUint32(),f=a.getUint32(),e=a.getUint32();if(0===f)switch(b){case "b":case "c":return a.getBooleanArray(c);
case "d":return a.getFloat64Array(c);case "f":return a.getFloat32Array(c);case "i":return a.getInt32Array(c);case "l":return a.getInt64Array(c)}"undefined"===typeof Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");a=new Zlib.Inflate(new Uint8Array(a.getArrayBuffer(e)));a=new r(a.decompress().buffer);switch(b){case "b":case "c":return a.getBooleanArray(c);case "d":return a.getFloat64Array(c);case "f":return a.getFloat32Array(c);
case "i":return a.getInt32Array(c);case "l":return a.getInt64Array(c)}default:throw Error("THREE.FBXLoader: Unknown property type "+b);}}};r.prototype={constructor:r,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(a){this.offset+=a},getBoolean:function(){return 1===(this.getUint8()&1)},getBooleanArray:function(a){for(var b=[],c=0;c<a;c++)b.push(this.getBoolean());return b},getUint8:function(){var a=this.dv.getUint8(this.offset);this.offset+=
1;return a},getInt16:function(){var a=this.dv.getInt16(this.offset,this.littleEndian);this.offset+=2;return a},getInt32:function(){var a=this.dv.getInt32(this.offset,this.littleEndian);this.offset+=4;return a},getInt32Array:function(a){for(var b=[],c=0;c<a;c++)b.push(this.getInt32());return b},getUint32:function(){var a=this.dv.getUint32(this.offset,this.littleEndian);this.offset+=4;return a},getInt64:function(){if(this.littleEndian){var a=this.getUint32();var b=this.getUint32()}else b=this.getUint32(),
a=this.getUint32();return b&2147483648?(b=~b&4294967295,a=~a&4294967295,4294967295===a&&(b=b+1&4294967295),-(4294967296*b+(a+1&4294967295))):4294967296*b+a},getInt64Array:function(a){for(var b=[],c=0;c<a;c++)b.push(this.getInt64());return b},getUint64:function(){if(this.littleEndian){var a=this.getUint32();var b=this.getUint32()}else b=this.getUint32(),a=this.getUint32();return 4294967296*b+a},getFloat32:function(){var a=this.dv.getFloat32(this.offset,this.littleEndian);this.offset+=4;return a},getFloat32Array:function(a){for(var b=
[],c=0;c<a;c++)b.push(this.getFloat32());return b},getFloat64:function(){var a=this.dv.getFloat64(this.offset,this.littleEndian);this.offset+=8;return a},getFloat64Array:function(a){for(var b=[],c=0;c<a;c++)b.push(this.getFloat64());return b},getArrayBuffer:function(a){var b=this.dv.buffer.slice(this.offset,this.offset+a);this.offset+=a;return b},getString:function(a){for(var b=[],c=0;c<a;c++)b[c]=this.getUint8();a=b.indexOf(0);0<=a&&(b=b.slice(0,a));return THREE.LoaderUtils.decodeText(new Uint8Array(b))}};
A.prototype={constructor:A,add:function(a,b){this[a]=b}};var K=[],F=new THREE.Euler,C=new THREE.Vector3;return c}();
